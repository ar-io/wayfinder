<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wayfinder Performance & Usage</title>
    <!-- AR.IO Brand Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Albert+Sans:wght@400;600&family=DM+Sans:wght@400;500&family=JetBrains+Mono:wght@400;500&family=Rubik:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/variables.css" />
    <link rel="stylesheet" href="assets/css/performance.css" />
    <script type="module" src="performance.js"></script>
  </head>
  <body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <div class="performance-container">
      <!-- Header -->
      <header class="performance-header">
        <div class="header-content">
          <div class="header-left">
            <button class="back-button" id="backToMain">
              <svg width="32" height="32" viewBox="0 0 36 36" fill="none">
                <path d="M21.75 27L13.5 18.75L21.75 10.5" stroke="var(--colors-icons-iconHigh)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="header-title">
              <h1>Performance & Usage</h1>
              <p>View performance analytics</p>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="performance-content">

        <!-- Time Filter -->
      <section class="filter-section">
        <div class="time-filter">
          <button class="filter-btn active" data-period="today">Today</button>
          <button class="filter-btn" data-period="week">7 Days</button>
          <button class="filter-btn" data-period="month">30 Days</button>
          <button class="filter-btn" data-period="all">All Time</button>
        </div>
        
        <div class="sort-options">
          <label for="sortBy">Sort by:</label>
          <select id="sortBy" class="sort-select">
            <option value="requests">Most Used</option>
            <option value="recent">Most Recent</option>
            <option value="performance">Best Performance</option>
            <option value="success">Success Rate</option>
          </select>
        </div>
      </section>

      <!-- Summary Stats -->
      <section class="stats-section">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="totalRequests">0</div>
            <div class="stat-label">AR.IO Requests</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-value" id="uniqueGateways">0</div>
            <div class="stat-label">AR.IO Gateways</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-value" id="avgResponseTime">--</div>
            <div class="stat-label">Avg Response Time</div>
          </div>

          <div class="stat-card">
            <div class="stat-value" id="permawebRatio">--</div>
            <div class="stat-label">Permaweb Usage</div>
          </div>
        </div>
      </section>

      <!-- Verification Performance Section -->
      <section class="verification-section">
        <div class="section-header">
          <h2>Verification Performance</h2>
          <p>Data integrity verification and cache efficiency metrics</p>
        </div>
        
        <div class="verification-cards">
          <div class="verification-card">
            <div class="verification-header">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <rect x="4" y="15" width="24" height="14" rx="2" stroke="var(--colors-icons-iconHigh)" stroke-width="2"/>
                <path d="M9 15V9C9 6.23858 11.2386 4 14 4H18C20.7614 4 23 6.23858 23 9V15" stroke="var(--colors-icons-iconHigh)" stroke-width="2"/>
              </svg>
              <h3>Verification Stats</h3>
            </div>
            <div class="verification-stats">
              <div class="stat">
                <span class="stat-value" id="verifiedTransactions">--</span>
                <span class="stat-label">Verified Transactions</span>
              </div>
              <div class="stat">
                <span class="stat-value" id="verificationSuccessRate">--</span>
                <span class="stat-label">Verification Success</span>
              </div>
            </div>
          </div>
        </div>

        <div class="verification-actions">
          <div class="action-card">
            <div class="action-header">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <path d="M5 8H27" stroke="var(--colors-icons-iconHigh)" stroke-width="2" stroke-linecap="round"/>
                <path d="M25 8V26C25 27.1046 24.1046 28 23 28H9C7.89543 28 7 27.1046 7 26V8" stroke="var(--colors-icons-iconHigh)" stroke-width="2" stroke-linecap="round"/>
                <path d="M11 8V6C11 4.89543 11.8954 4 13 4H19C20.1046 4 21 4.89543 21 6V8" stroke="var(--colors-icons-iconHigh)" stroke-width="2" stroke-linecap="round"/>
                <path d="M13 15V21" stroke="var(--colors-icons-iconHigh)" stroke-width="2" stroke-linecap="round"/>
                <path d="M19 15V21" stroke="var(--colors-icons-iconHigh)" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <div class="action-info">
                <h3>Clear Cache Data</h3>
                <p>Clear verification cache and performance metrics</p>
              </div>
              <div class="button-group">
                <button class="secondary-button" id="clearVerificationCache">Clear Cache</button>
                <button class="danger-button" id="clearPerformanceData">Clear All Data</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Gateway Usage List -->
      <section class="gateway-usage-section">
        <div class="section-header">
          <h2>Gateway Usage</h2>
          <p id="periodLabel">Showing usage for today</p>
        </div>
        
        <div class="gateway-usage-list" id="gatewayUsageList">
          <!-- Gateway usage cards will be populated here -->
        </div>
        
        <div class="empty-state" id="emptyState" style="display: none;">
          <svg class="empty-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" opacity="0.5">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <h3>No History Found</h3>
          <p>Start browsing ar:// links to see gateway usage statistics.</p>
        </div>
        
        <div class="loading-state" id="loadingState" style="display: none;">
          <div class="loading-spinner"></div>
          <p>Loading history...</p>
        </div>
      </section>

      </main>

      <!-- Footer -->
      <footer class="performance-footer">
        <div class="footer-content">
          <div class="footer-links">
            <a href="https://github.com/ar-io/wayfinder" target="_blank" rel="noopener noreferrer">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.564 9.564 0 0112 6.844a9.59 9.59 0 012.504.337c1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"/>
              </svg>
            </a>
            <a href="https://discord.gg/ar-io" target="_blank" rel="noopener noreferrer">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.317 4.369a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.617-1.25.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.078.078 0 00.084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 00-.041-.106 13.107 13.107 0 01-1.872-.892.077.077 0 01-.008-.128 10.2 10.2 0 00.372-.292.074.074 0 01.077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 01.078.01c.12.098.246.198.373.292a.077.077 0 01-.006.127 12.299 12.299 0 01-1.873.892.077.077 0 00-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 00.084.028 19.839 19.839 0 006.002-3.03.077.077 0 00.032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
              </svg>
            </a>
            <a href="https://ar.io" target="_blank" rel="noopener noreferrer">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </a>
          </div>
          <div class="footer-info">
            <span id="dataRange">--</span>
          </div>
          <div class="version-info">
            <span id="extensionVersion">v0.1.0</span>
          </div>
        </div>
      </footer>
    </div>

    <!-- Gateway Details Modal -->
    <div id="gatewayModal" class="modal" style="display: none;">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title-section">
            <h2>Gateway Details</h2>
            <div class="gateway-status-badge" id="modalStatusBadge">
              <div class="status-dot"></div>
              <span>Unknown</span>
            </div>
          </div>
          <button class="close-btn" id="closeModal">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        
        <div class="modal-body">
          <!-- Basic Information -->
          <div class="modal-section">
            <div class="section-title">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M2 12h20"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
              </svg>
              <h3>Gateway Information</h3>
            </div>
            
            <div class="modal-field-group">
              <div class="modal-field">
                <label>Gateway URL</label>
                <a id="modal-gateway-url" class="value-link" href="#" target="_blank">
                  <span>--</span>
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/>
                  </svg>
                </a>
              </div>
              
              <div class="modal-field">
                <label>Wallet Address</label>
                <a id="modal-gateway-wallet" class="value-link" href="#" target="_blank">
                  <span>--</span>
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/>
                  </svg>
                </a>
              </div>
              
              <div class="modal-field">
                <label>Total Stake</label>
                <span id="modal-total-stake" class="field-value">--</span>
              </div>
              
              <div class="modal-field">
                <label>Avg Response Time</label>
                <span id="modal-gateway-avg-response-time" class="field-value">--</span>
              </div>
              
              <div class="modal-field">
                <label>Start Date</label>
                <span id="modal-start" class="field-value">--</span>
              </div>
              
              <div class="modal-field">
                <label>Usage Count</label>
                <span id="modal-usage-count" class="field-value">--</span>
              </div>
            </div>
          </div>
          
          <!-- Usage Statistics -->
          <div class="modal-section">
            <div class="section-title">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
              </svg>
              <h3>Usage Statistics</h3>
            </div>
            
            <div class="usage-stats-grid">
              <div class="stat-card">
                <div class="stat-label">Success Rate</div>
                <div id="modal-success-rate" class="stat-value">--</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Failed Requests</div>
                <div id="modal-failed-requests" class="stat-value">--</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Last Used</div>
                <div id="modal-last-used" class="stat-value">--</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>